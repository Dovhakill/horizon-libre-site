<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}{{ site_name }}{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}L'Horizon Libre est un média 100% indépendant qui propose des analyses, enquêtes et reportages sur l'actualité.{% endblock %}">
    
    {% block social_meta %}
    <meta property="og:title" content="{% block og_title %}{{ self.title() }}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{{ self.meta_description() }}{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ site_url }}{{ page_url or '/' }}">
    <meta property="og:image" content="{{ site_url }}/img/og-default.jpg">
    <meta name="twitter:card" content="summary_large_image">
    {% endblock %}

    {% block head %}{% endblock %}
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "{{ site_name }}",
      "url": "{{ site_url }}",
      "contactPoint": {
        "@type": "ContactPoint",
        "email": "{{ contact_email }}",
        "contactType": "customer service"
      }
    }
    </script>
</head>
<body>
    <header>
        <a href="/">Accueil</a>
        <a href="/about.html">À Propos</a>
        <a href="/contact.html">Contact</a>
    </header>

    <main>
        {% block content %}{% endblock %}
    </main>

    <footer>
        <p>&copy; {{ "now"|date("Y") }} {{ site_name }}</p>
        <a href="/mentions-legales.html">Mentions légales</a>
        <a href="/privacy-policy.html">Politique de confidentialité</a>
        <a href="/cookie-policy.html">Gestion des cookies</a>
    </footer>

    <div id="cookie-consent-banner" style="display:none; position:fixed; bottom:0; left:0; right:0; background:#2d3748; color:white; padding:1rem; z-index:1000; text-align:center;">
        <p>Ce site utilise des cookies pour améliorer votre expérience. <a href="/cookie-policy.html" style="color:#63b3ed;">En savoir plus</a>.</p>
        <button id="consent-accept" style="background:#4299e1; padding:0.5rem 1rem; border:none; border-radius:0.25rem; margin:0.5rem;">Accepter tout</button>
        <button id="consent-refuse" style="background:#a0aec0; padding:0.5rem 1rem; border:none; border-radius:0.25rem; margin:0.5rem;">Refuser tout</button>
        <button id="consent-settings" style="background:transparent; border:1px solid white; padding:0.5rem 1rem; border-radius:0.25rem; margin:0.5rem;">Paramétrer</button>
    </div>

    {% block footer_scripts %}
    <script>
    (function() {
        const COOKIE_CONSENT_KEY = 'cookie_consent';
        const banner = document.getElementById('cookie-consent-banner');
        const acceptBtn = document.getElementById('consent-accept');
        const refuseBtn = document.getElementById('consent-refuse');
        
        const consent = JSON.parse(localStorage.getItem(COOKIE_CONSENT_KEY));

        function setConsent(consentValue) {
            const consentData = {
                accepted: consentValue,
                timestamp: new Date().toISOString(),
                categories: {
                    necessary: true,
                    analytics: consentValue,
                    advertising: consentValue
                }
            };
            localStorage.setItem(COOKIE_CONSENT_KEY, JSON.stringify(consentData));
            banner.style.display = 'none';
            runScripts(consentData.categories);
        }

        function runScripts(categories) {
            document.querySelectorAll('script[type="text/plain"][data-cookie-category]').forEach(script => {
                const category = script.getAttribute('data-cookie-category');
                if (categories[category]) {
                    const newScript = document.createElement('script');
                    script.getAttributeNames().forEach(attr => newScript.setAttribute(attr, script.getAttribute(attr)));
                    newScript.type = 'text/javascript';
                    script.parentNode.replaceChild(newScript, script);
                }
            });
        }

        if (!consent) {
            banner.style.display = 'block';
        } else {
            runScripts(consent.categories);
        }

        acceptBtn.addEventListener('click', () => setConsent(true));
        refuseBtn.addEventListener('click', () => setConsent(false));
    })();
    </script>
    {% endblock %}
</body>
</html>
