<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}L'Horizon Libre{% endblock %}</title>
    <style>
        /* Ajout d'un peu de style pour les résultats de recherche */
        #search-results { max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-2">
                <a href="/" title="Accueil - L'Horizon Libre">
                    </a>
                <nav class="hidden md:flex items-center space-x-8">
                    </nav>
                <div class="relative">
                    <input type="search" id="search-input" placeholder="Rechercher..." class="border rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <div id="search-results" class="hidden absolute top-full left-0 right-0 w-72 bg-white border rounded-lg shadow-lg mt-2 p-2 z-50">
                        </div>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
        {% block content %}{% endblock %}
    </main>

    <footer class="bg-gray-800 text-gray-300 mt-16">
        </footer>
    
    <script>
        feather.replace(); // Pour tes icônes
    </script>

    <script>
    (function() {
        const searchInput = document.getElementById('search-input');
        const searchResults = document.getElementById('search-results');
        let searchIndex = [];

        // On ne charge l'index qu'une seule fois
        fetch('/search-index.json')
            .then(response => response.json())
            .then(data => {
                searchIndex = data;
                console.log("Index de recherche chargé.");
            })
            .catch(error => console.error("Erreur de chargement de l'index de recherche:", error));

        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim().toLowerCase();
            
            // On affiche les résultats seulement si la recherche contient au moins 3 caractères
            if (query.length < 3) {
                searchResults.classList.add('hidden');
                return;
            }

            const results = searchIndex.filter(item => 
                item.title.toLowerCase().includes(query) || 
                item.description.toLowerCase().includes(query)
            );

            searchResults.innerHTML = ''; // On vide les anciens résultats
            
            if (results.length > 0) {
                // On affiche les 5 premiers résultats maximum
                results.slice(0, 5).forEach(result => {
                    const item = document.createElement('a');
                    item.href = result.url;
                    item.className = 'block p-2 text-sm text-gray-800 hover:bg-gray-100 rounded';
                    
                    const title = document.createElement('strong');
                    title.textContent = result.title;
                    
                    const desc = document.createElement('span');
                    desc.className = 'block text-xs text-gray-500 mt-1';
                    desc.textContent = result.description.substring(0, 80) + '...';

                    item.appendChild(title);
                    item.appendChild(desc);
                    searchResults.appendChild(item);
                });
            } else {
                const noResult = document.createElement('p');
                noResult.className = 'p-2 text-sm text-gray-500';
                noResult.textContent = 'Aucun résultat trouvé.';
                searchResults.appendChild(noResult);
            }
            searchResults.classList.remove('hidden');
        });
        
        // On cache les résultats si on clique n'importe où sur la page
        document.addEventListener('click', (e) => {
            if (!searchResults.contains(e.target) && e.target !== searchInput) {
                searchResults.classList.add('hidden');
            }
        });
    })();
    </script>
</body>
</html>
